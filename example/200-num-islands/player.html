<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>岛屿数量算法动画</title>
  <style>
    body { font-family: Arial; margin: 20px; }
    .grid { display: inline-block; border: 1px solid #ccc; }
    .cell { width: 40px; height: 40px; text-align: center; line-height: 40px; 
            border: 1px solid #999; font-weight: bold; }
    .land { background-color: #4CAF50; color: white; }
    .water { background-color: #bbdefb; }
    .current { outline: 3px solid red; }
    .stack { margin-top: 10px; font-family: monospace; }
    button { margin: 10px; padding: 8px 16px; font-size: 16px; }
    .info { margin: 10px 0; font-size: 18px; }
  </style>
</head>
<body>
  <h2>岛屿数量 (DFS) 执行动画</h2>
  <div class="info">岛屿数量: <span id="count">0</span></div>
  <div id="gridContainer"></div>
  <div class="stack">调用栈: <span id="stack"></span></div>
  <!-- 在按钮上方添加 -->
  <div id="explanation" style="
  margin: 15px 0;
  padding: 12px;
  background-color: #f9f9f9;
  border-left: 4px solid #4CAF50;
  font-size: 16px;
  line-height: 1.5;
  "></div>
  <button onclick="prevStep()">◀ 上一步</button>
  <button onclick="nextStep()">下一步 ▶</button>
  <div id="action" style="margin-top:10px; font-style:italic;"></div>

  <script>
    // 加载 trace.json（这里内联简化）
    fetch('trace.json')
      .then(res => res.json())
      .then(data => {
        window.trace = data;
        window.step = 0;
        render();
      });

    function render() {
      const frame = window.trace[window.step];
      document.getElementById('count').textContent = frame.count;
      document.getElementById('explanation').textContent = frame.explanation;
      document.getElementById('action').textContent = 
        `${frame.action} at (${frame.i}, ${frame.j})`;

      // 使用 <table> 渲染网格
      let tableHtml = '<table style="border-collapse: collapse; margin: 10px;">';
      for (let i = 0; i < frame.grid.length; i++) {
        tableHtml += '<tr>';
        for (let j = 0; j < frame.grid[i].length; j++) {
          const cell = frame.grid[i][j];
          const isLand = (cell === '1');
          const isCurrent = (frame.i === i && frame.j === j && 
                            ['enter_dfs', 'found_island'].includes(frame.action));
          
          tableHtml += `
            <td 
              style="
                width: 40px; 
                height: 40px; 
                text-align: center; 
                vertical-align: middle;
                border: 1px solid #999;
                background-color: ${isLand ? '#4CAF50' : '#bbdefb'};
                color: white;
                font-weight: bold;
                ${isCurrent ? 'outline: 3px solid red;' : ''}
              ">
              ${cell}
            </td>`;
        }
        tableHtml += '</tr>';
      }
      tableHtml += '</table>';
      
      document.getElementById('gridContainer').innerHTML = tableHtml;

      // 渲染调用栈
      const stackStr = frame.call_stack
        .map(([i, j]) => `(${i},${j})`)
        .join(' → ');
      document.getElementById('stack').textContent = stackStr || '空';
    }

    function nextStep() {
      if (window.step < window.trace.length - 1) {
        window.step++;
        render();
      }
    }

    function prevStep() {
      if (window.step > 0) {
        window.step--;
        render();
      }
    }

    // 键盘支持
    document.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowRight') nextStep();
      if (e.key === 'ArrowLeft') prevStep();
    });
  </script>
</body>
</html>