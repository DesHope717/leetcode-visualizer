<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>33. æœç´¢æ—‹è½¬æ’åºæ•°ç»„ - ç®—æ³•å¯è§†åŒ–</title>
  <style>
    body { font-family: 'Segoe UI', sans-serif; margin: 20px; background: #f9f9f9; }
    .container { max-width: 900px; margin: 0 auto; }
    h1 { color: #2d3e50; text-align: center; }
    .array-container {
      display: flex;
      justify-content: center;
      margin: 20px 0;
      flex-wrap: wrap;
    }
    .cell {
      width: 50px;
      height: 50px;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 1px solid #ccc;
      margin: 2px;
      background: #fff;
      font-weight: bold;
      position: relative;
    }
    .index-label {
      position: absolute;
      top: -20px;
      font-size: 12px;
      color: #636e72;
    }
    .left { background: #74b9ff !important; border-color: #0984e3; }
    .mid { background: #fdcb6e !important; border-color: #e17055; }
    .right { background: #a29bfe !important; border-color: #6c5ce7; }
    .found { background: #55efc4 !important; border-color: #00b894; }
    .explanation { 
      background: #2d3436; color: #fdcb6e; padding: 12px; border-radius: 6px; 
      margin: 15px 0; font-size: 16px; line-height: 1.5;
    }
    .legend {
      text-align: center;
      margin: 10px 0;
      color: #636e72;
    }
    .legend span {
      margin: 0 8px;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 14px;
    }
    .legend .left-legend { background: #74b9ff; }
    .legend .mid-legend { background: #fdcb6e; }
    .legend .right-legend { background: #a29bfe; }
    .legend .found-legend { background: #55efc4; }

    .controls { text-align: center; margin: 20px 0; }
    button { 
      padding: 8px 16px; 
      margin: 0 5px; 
      font-size: 16px; 
      cursor: pointer; 
      border: 1px solid #ccc;
      border-radius: 4px;
      background: white;
    }
    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    .step-info { text-align: center; color: #636e72; margin-top: 10px; }
    .target-info {
      text-align: center;
      font-size: 18px;
      color: #e17055;
      margin-bottom: 10px;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>33. æœç´¢æ—‹è½¬æ’åºæ•°ç»„</h1>
    <p style="text-align:center; color:#636e72;">åœ¨æ—‹è½¬åçš„æ’åºæ•°ç»„ä¸­é«˜æ•ˆæŸ¥æ‰¾ç›®æ ‡å€¼</p>

    <div class="target-info">ğŸ¯ ç›®æ ‡å€¼: <span id="target-value">?</span></div>

    <div class="legend">
      <span class="left-legend">left</span>
      <span class="mid-legend">mid</span>
      <span class="right-legend">right</span>
      <span class="found-legend">æ‰¾åˆ°ç›®æ ‡</span>
    </div>

    <div class="controls">
      <button id="prev">â—€ ä¸Šä¸€æ­¥</button>
      <button id="play">â–¶ æ’­æ”¾</button>
      <button id="next">ä¸‹ä¸€æ­¥ â–¶</button>
      <button id="reset">â†º é‡ç½®</button>
    </div>
    <div class="step-info">æ­¥éª¤: <span id="step-counter">0 / 0</span></div>

    <div class="explanation" id="explanation">åŠ è½½ä¸­...</div>

    <div class="array-container" id="array-container"></div>
  </div>

  <script>
    // ç­‰å¾… DOM å®Œå…¨åŠ è½½
    document.addEventListener('DOMContentLoaded', () => {
      const targetValueEl = document.getElementById('target-value');
      const explanationEl = document.getElementById('explanation');
      const stepCounterEl = document.getElementById('step-counter');
      const arrayContainer = document.getElementById('array-container');
      const btnPrev = document.getElementById('prev');
      const btnNext = document.getElementById('next');
      const btnPlay = document.getElementById('play');
      const btnReset = document.getElementById('reset');

      let trace = [];
      let currentStep = 0;
      let totalSteps = 0;
      let playing = false;
      let playInterval = null;

      // æ¸²æŸ“å½“å‰æ­¥éª¤
      function render(stepData) {
        // æ›´æ–°ç›®æ ‡å€¼ï¼ˆæ¯ä¸€æ­¥éƒ½åŒæ­¥ï¼Œæ›´å¯é ï¼‰
        if (stepData.target !== undefined) {
          targetValueEl.textContent = stepData.target;
        }

        stepCounterEl.textContent = `${currentStep + 1} / ${totalSteps}`;
        explanationEl.textContent = stepData.explanation || 'æ— è¯´æ˜';

        // æ¸…ç©ºå¹¶é‡å»ºæ•°ç»„è§†å›¾
        arrayContainer.innerHTML = '';

        const nums = stepData.nums || [];
        const left = stepData.left;
        const mid = stepData.mid;
        const right = stepData.right;
        const found = stepData.found;

        nums.forEach((val, i) => {
          const cell = document.createElement('div');
          cell.className = 'cell';
          cell.textContent = val;

          const label = document.createElement('div');
          label.className = 'index-label';
          label.textContent = i;
          cell.appendChild(label);

          // é«˜äº®é€»è¾‘ï¼šfound ä¼˜å…ˆçº§æœ€é«˜
          if (found && i === mid) {
            cell.classList.add('found');
          } else {
            if (i === left) cell.classList.add('left');
            if (i === mid) cell.classList.add('mid');
            if (i === right) cell.classList.add('right');
          }

          arrayContainer.appendChild(cell);
        });

        // æ›´æ–°æŒ‰é’®çŠ¶æ€
        btnPrev.disabled = currentStep <= 0;
        btnNext.disabled = currentStep >= totalSteps - 1;
      }

      // æ§åˆ¶é€»è¾‘
      function nextStep() {
        if (currentStep < totalSteps - 1) {
          currentStep++;
          render(trace[currentStep]);
        }
      }

      function prevStep() {
        if (currentStep > 0) {
          currentStep--;
          render(trace[currentStep]);
        }
      }

      function reset() {
        currentStep = 0;
        render(trace[0]);
        stopPlay();
      }

      function startPlay() {
        if (playing || currentStep >= totalSteps - 1) return;
        playing = true;
        btnPlay.textContent = 'â¸ æš‚åœ';
        playInterval = setInterval(() => {
          if (currentStep >= totalSteps - 1) {
            stopPlay();
          } else {
            nextStep();
          }
        }, 1500);
      }

      function stopPlay() {
        playing = false;
        clearInterval(playInterval);
        btnPlay.textContent = 'â–¶ æ’­æ”¾';
      }

      // ç»‘å®šäº‹ä»¶
      btnNext.addEventListener('click', nextStep);
      btnPrev.addEventListener('click', prevStep);
      btnReset.addEventListener('click', reset);
      btnPlay.addEventListener('click', () => {
        if (playing) stopPlay();
        else startPlay();
      });

      // åŠ è½½è½¨è¿¹æ•°æ®
      fetch('trace.json')
        .then(res => {
          if (!res.ok) throw new Error(`HTTP error! status: ${res.status}`);
          return res.json();
        })
        .then(data => {
          trace = data;
          totalSteps = trace.length;

          if (totalSteps === 0) {
            throw new Error('è½¨è¿¹ä¸ºç©º');
          }

          // åˆå§‹æ¸²æŸ“
          render(trace[0]);
        })
        .catch(err => {
          console.error('åŠ è½½å¤±è´¥:', err);
          explanationEl.textContent = `âŒ åŠ è½½ trace.json å¤±è´¥: ${err.message}`;
          targetValueEl.textContent = '?';
        });
    });
  </script>
</body>
</html>